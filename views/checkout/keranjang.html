<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Keranjang Belanja</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body class="bg-gray-100">
  <div class="container mx-auto p-4">
    <h1 class="text-2xl font-bold mb-4">Keranjang</h1>
    <div id="cart" class="bg-white rounded-lg shadow p-4 space-y-4"></div>
  </div>

  <script>
    let cartItems = [
      {
        id: 1,
        store: "AGRES ID",
        product: "LENOVO IDEAPAD SLIM 3 14 I7 13620H 16GB 512GB W11+OHS 14.0 FHD",
        details: "Non Bundle, WINDOWS 11 HOME",
        price: 10849000,
        quantity: 1,
      },
      {
        id: 2,
        store: "Thinkpad Official Store",
        product: "Lenovo IdeaPad Slim 3 Core I7 13620H 16GB RAM 512GB SSD 14 Inch",
        details: "Blue W11 Home, Normal Bundling",
        price: 10849000,
        quantity: 1,
      },
      {
        id: 3,
        store: "EnVicStore",
        product: "Macbook Air M2 8C CPU 8GB 512SSD 10C GPU OS X Resmi Apple",
        details: "STANDART, MIDNIGHT-512",
        price: 16999000,
        quantity: 1,
      },
    ];

    function renderCart() {
      const cartContainer = document.getElementById("cart");
      cartContainer.innerHTML = ""; // Clear previous content

      cartItems.forEach((item) => {
        const itemHTML = `
          <div class="border rounded-lg p-4 flex flex-col md:flex-row items-start md:items-center">
            <div class="w-full md:w-3/4">
              <h2 class="text-lg font-semibold">${item.store}</h2>
              <p class="text-sm font-medium">${item.product}</p>
              <p class="text-sm text-gray-500">${item.details}</p>
              <div class="mt-2">
                <span class="text-lg font-bold text-blue-500">Rp${item.price.toLocaleString()}</span>
              </div>
            </div>
            <div class="w-full md:w-1/4 mt-4 md:mt-0 flex items-center space-x-6">
              <div class="flex items-center border rounded-lg px-2">
                <button class="text-gray-600 hover:text-blue-500 px-2" onclick="updateQuantity(${item.id}, -1)">
                  <i class="fas fa-minus"></i>
                </button>
                <span class="text-lg font-medium px-2">${item.quantity}</span>
                <button class="text-gray-600 hover:text-blue-500 px-2" onclick="updateQuantity(${item.id}, 1)">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
              <button class="text-red-500 hover:text-red-700" onclick="removeItem(${item.id})">
                <i class="fas fa-trash text-lg"></i>
              </button>
              <button class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                Checkout
              </button>
            </div>
          </div>
        `;
        cartContainer.innerHTML += itemHTML;
      });
    }

    function updateQuantity(id, change) {
      cartItems = cartItems.map(item => {
        if (item.id === id) {
          return {
            ...item,
            quantity: Math.max(1, item.quantity + change), // Ensure quantity is at least 1
          };
        }
        return item;
      });
      renderCart();
    }

    function removeItem(id) {
      cartItems = cartItems.filter(item => item.id !== id);
      renderCart();
    }

    async function checkoutItem(id) {
      const item = cartItems.find(item => item.id === id);
      if (!item) return;

      try {
        const response = await fetch('/checkout', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(item),
        });

        if (response.ok) {
          Swal.fire({
            icon: 'success',
            title: 'Berhasil',
            text: `Checkout untuk ${item.product} berhasil!`,
          });
        } else {
          throw new Error('Gagal melakukan checkout');
        }
      } catch (error) {
        Swal.fire({
          icon: 'error',
          title: 'Gagal',
          text: error.message,
        });
      }
    }

    renderCart();
  </script>
</body>
</html>
